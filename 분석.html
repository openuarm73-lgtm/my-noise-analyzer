<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì†Œë¦¬ ë¶„ì„ê¸°</title>
<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    text-align: center;
    padding: 20px;
}
button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    font-weight: bold;
    color: white;
    cursor: pointer;
}
#connectBtn { background-color: #38a169; }
#startBtn { background-color: #3182ce; }
#stopBtn { background-color: #e53e3e; }
#status { margin-top: 15px; font-size: 1rem; }
#elapsedTime { margin-top: 8px; color: #333; font-size: 0.9rem; }
</style>
</head>
<body>
<h2>ğŸ¤ ì†Œë¦¬ ë¶„ì„ê¸°</h2>

<button id="connectBtn">ë§ˆì´í¬ ì—°ê²°</button>
<button id="startBtn" disabled>ë¶„ì„ ì‹œì‘</button>
<button id="stopBtn" disabled>ì¤‘ì§€</button>

<div id="status">ëŒ€ê¸° ì¤‘...</div>
<div id="elapsedTime">ğŸ•’ ê²½ê³¼: 0ì´ˆ</div>

<script>
let audioContext, analyser, source, stream;
let isRunning = false;
let startTime = 0;
let timer = null;

const connectBtn = document.getElementById("connectBtn");
const startBtn = document.getElementById("startBtn");
const stopBtn = document.getElementById("stopBtn");
const statusEl = document.getElementById("status");
const elapsedEl = document.getElementById("elapsedTime");

connectBtn.onclick = async () => {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        source = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        source.connect(analyser);

        connectBtn.disabled = true;
        startBtn.disabled = false;
        statusEl.textContent = "âœ… ë§ˆì´í¬ ì—°ê²° ì™„ë£Œ. ë¶„ì„ ì‹œì‘ ê°€ëŠ¥.";
    } catch (err) {
        statusEl.textContent = "âŒ ë§ˆì´í¬ ì—°ê²° ì‹¤íŒ¨: " + err.message;
    }
};

startBtn.onclick = () => {
    if (!analyser) return;
    isRunning = true;
    startTime = Date.now();
    startBtn.disabled = true;
    stopBtn.disabled = false;
    statusEl.textContent = "ğŸ“Š ë¶„ì„ ì¤‘...";
    timer = setInterval(updateElapsedTime, 1000);
    requestAnimationFrame(analyze);
};

stopBtn.onclick = () => {
    isRunning = false;
    clearInterval(timer);
    startBtn.disabled = false;
    stopBtn.disabled = true;
    statusEl.textContent = "â¹ï¸ ë¶„ì„ ì¤‘ì§€ë¨.";
};

function updateElapsedTime() {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    elapsedEl.textContent = `ğŸ•’ ê²½ê³¼: ${elapsed}ì´ˆ`;
}

function analyze() {
    if (!isRunning) return;
    const data = new Float32Array(analyser.frequencyBinCount);
    analyser.getFloatFrequencyData(data);
    const peak = Math.max(...data);
    // í•„ìš” ì‹œ ë¶„ì„ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
    requestAnimationFrame(analyze);
}
</script>
</body>
</html>
