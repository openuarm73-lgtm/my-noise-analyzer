<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì†Œë¦¬ ë¶„ì„ê¸°</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f7fafc;
    margin: 0;
    padding: 20px;
}
.container {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    max-width: 500px;
    margin: auto;
}
h1 {
    text-align: center;
}
button {
    margin: 5px;
    padding: 10px 15px;
    border: none;
    border-radius: 6px;
    color: white;
    font-weight: bold;
    cursor: pointer;
}
#connectBtn { background-color: #38a169; }
#startBtn { background-color: #3182ce; }
#stopBtn { background-color: #e53e3e; }
#status { margin-top: 10px; font-weight: bold; }
#timeElapsed { margin-top: 5px; color: #555; font-size: 0.9rem; }
</style>
</head>
<body>
<div class="container">
    <h1>ğŸ¤ ì†Œë¦¬ ë¶„ì„ê¸°</h1>
    <button id="connectBtn">ë§ˆì´í¬ ì—°ê²°</button>
    <button id="startBtn" disabled>ë¶„ì„ ì‹œì‘</button>
    <button id="stopBtn" disabled>ì¤‘ì§€</button>

    <div id="status">ëŒ€ê¸° ì¤‘...</div>
    <div id="timeElapsed">ğŸ•’ ê²½ê³¼: 0ì´ˆ</div>
</div>

<script>
let audioContext, analyser, source, stream;
let isRunning = false;
let startTime = 0;
let timer = null;

const connectBtn = document.getElementById('connectBtn');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const statusEl = document.getElementById('status');
const timeEl = document.getElementById('timeElapsed');

connectBtn.onclick = async () => {
    try {
        stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        source = audioContext.createMediaStreamSource(stream);
        analyser = audioContext.createAnalyser();
        source.connect(analyser);

        connectBtn.disabled = true;
        startBtn.disabled = false;
        statusEl.textContent = "âœ… ë§ˆì´í¬ ì—°ê²°ë¨. ë¶„ì„ ì‹œì‘ ê°€ëŠ¥.";
    } catch (err) {
        statusEl.textContent = "âŒ ë§ˆì´í¬ ì—°ê²° ì‹¤íŒ¨: " + err.message;
    }
};

startBtn.onclick = () => {
    if (!analyser) return;
    isRunning = true;
    startTime = Date.now();
    startBtn.disabled = true;
    stopBtn.disabled = false;
    statusEl.textContent = "ğŸ“Š ë¶„ì„ ì¤‘...";
    timer = setInterval(updateElapsedTime, 1000);
    requestAnimationFrame(analyze);
};

stopBtn.onclick = () => {
    isRunning = false;
    clearInterval(timer);
    startBtn.disabled = false;
    stopBtn.disabled = true;
    statusEl.textContent = "â¹ï¸ ë¶„ì„ ì¤‘ì§€ë¨.";
};

function updateElapsedTime() {
    const elapsed = Math.floor((Date.now() - startTime) / 1000);
    timeEl.textContent = `ğŸ•’ ê²½ê³¼: ${elapsed}ì´ˆ`;
}

function analyze() {
    if (!isRunning) return;
    const data = new Float32Array(analyser.frequencyBinCount);
    analyser.getFloatFrequencyData(data);
    const peak = Math.max(...data);
    // í•„ìš” ì‹œ ì—¬ê¸°ì—ì„œ ë¶„ì„ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
    requestAnimationFrame(analyze);
}
</script>
</body>
</html>
